server {
    listen 80;
    server_name localhost;

    # Si entran a la raíz, van al Frontend estático
    location = / {
        proxy_pass http://frontend:80;
    }

    # Todo lo demás (login, app, api) va al Backend Laravel
    location ~ ^/(login|register|dashboard|books|scan|browse|logout|css|js|images|storage|build) {
        fastcgi_pass backend:9000;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME /var/www/public/index.php;
        fastcgi_param DOCUMENT_ROOT /var/www/public;
    }

    # Regla genérica para Laravel
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass backend:9000;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME /var/www/public$fastcgi_script_name;
    }
}